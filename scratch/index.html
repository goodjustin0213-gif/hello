<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ‹è»è²¡å‹™æˆ°æƒ…å®¤ v27.0 - å­¸è¡“æ±ºç­–ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans+TC:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0f172a; --panel: #1e293b; --accent: #38bdf8; --danger: #f43f5e; --success: #10b981; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg); color: #e2e8f0; height: 100vh; overflow: hidden; display: flex; margin: 0; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        aside { width: 380px; background: #0b1121; border-right: 1px solid #1e293b; display: flex; flex-direction: column; overflow-y: auto; }
        .input-card { background: var(--panel); padding: 16px; border-radius: 8px; border: 1px solid #334155; margin-bottom: 12px; }
        label { font-size: 0.75rem; color: #94a3b8; display: block; margin-bottom: 4px; font-weight: 700; }
        input, select { background: #0f172a; border: 1px solid #334155; color: white; padding: 6px 10px; border-radius: 4px; width: 100%; box-sizing: border-box; }
        .tab-btn { flex: 1; padding: 10px; text-align: center; cursor: pointer; color: #64748b; font-weight: bold; border-radius: 6px; }
        .tab-btn.active { background: #334155; color: var(--accent); }
        main { flex: 1; padding: 24px; overflow-y: auto; background: radial-gradient(circle at top right, #1e293b 0%, #0f172a 100%); }
        .kpi-card { background: rgba(30, 41, 59, 0.5); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; }
        table { width: 100%; font-size: 0.8rem; border-collapse: collapse; }
        th, td { padding: 10px; text-align: right; border-bottom: 1px solid #1e293b; }
        th { color: #64748b; }
        .alert-box { padding: 8px 12px; border-radius: 6px; margin-bottom: 16px; font-size: 0.85rem; font-weight: bold; }
    </style>
</head>
<body>



<aside>
    <div class="p-6 bg-slate-950">
        <h1 class="font-bold text-xl text-white">è²¡å‹™æˆ°æƒ…å®¤ <span class="text-cyan-400 text-xs">v27.0</span></h1>
    </div>

    <div class="p-4 space-y-4">
        <div class="flex bg-slate-900 p-1 rounded-lg">
            <div id="tab-A" class="tab-btn active" onclick="APP.switchTab('A')">æ–¹æ¡ˆ A</div>
            <div id="tab-B" class="tab-btn" onclick="APP.switchTab('B')">æ–¹æ¡ˆ B</div>
        </div>

        <div class="input-card">
            <label>èµ·å§‹/ç›®æ¨™éšç´š</label>
            <div class="grid grid-cols-2 gap-2 mb-3">
                <select id="currentRank" onchange="APP.update()"></select>
                <select id="targetRank" onchange="APP.update()"></select>
            </div>
            <label>æœå½¹å¹´è³‡ / å¯¦é ˜æ ¡æ­£</label>
            <div class="grid grid-cols-2 gap-2">
                <input type="number" id="years" value="20" oninput="APP.update()">
                <input type="number" id="realPay" value="0" oninput="APP.update()">
            </div>
        </div>

        <div class="input-card">
            <label>ç”Ÿæ´»æ”¯å‡ºæ¯” (%): <span id="livingPctLabel" class="text-white">50%</span></label>
            <input type="range" id="livingPct" min="10" max="90" value="50" class="w-full accent-rose-500" oninput="APP.updateInput('livingPct')">
            <label class="mt-3">å‰›æ€§æ”¯å‡º (ä¿éšª/å­è¦ª)</label>
            <input type="number" id="fixedCost" value="5000" oninput="APP.update()">
        </div>

        <div class="input-card">
            <label>å¹´å ±é…¬ ROI (%): <span id="roiLabel" class="text-white">6%</span></label>
            <input type="range" id="roi" min="1" max="15" value="6" class="w-full accent-emerald-500" oninput="APP.updateInput('roi')">
            <label class="mt-3">è³¼å±‹æ¨¡æ“¬</label>
            <input type="checkbox" id="buyHouse" onchange="APP.update()">
            <div id="housing-area" class="hidden mt-2 grid grid-cols-2 gap-2">
                <input type="number" id="buyYear" value="10" placeholder="è³¼å±‹å¹´">
                <input type="number" id="housePrice" value="1200" placeholder="ç¸½åƒ¹(è¬)">
            </div>
        </div>
    </div>
</aside>

<main>
    <div id="budget-msg" class="alert-box"></div>

    <div class="grid grid-cols-3 gap-6 mb-8">
        <div class="kpi-card border-l-4 border-cyan-500">
            <div class="text-xs text-slate-500 mb-1 uppercase font-bold">Plan A æœ€çµ‚è³‡ç”¢</div>
            <div class="kpi-val text-cyan-400 mono" id="kpi-A">--</div>
        </div>
        <div class="kpi-card border-l-4 border-emerald-500">
            <div class="text-xs text-slate-500 mb-1 uppercase font-bold">Plan B æœ€çµ‚è³‡ç”¢</div>
            <div class="kpi-val text-emerald-400 mono" id="kpi-B">--</div>
        </div>
        <div class="kpi-card border-l-4 border-amber-500">
            <div class="text-xs text-slate-500 mb-1 uppercase font-bold">æ•ˆç›Šå·®é¡</div>
            <div class="kpi-val text-amber-500 mono" id="kpi-diff">--</div>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-6 mb-8 h-80">
        <div class="kpi-card flex flex-col">
            <canvas id="chart-asset"></canvas>
        </div>
        <div class="kpi-card flex flex-col">
            <canvas id="chart-wealth"></canvas>
        </div>
    </div>

    <div class="kpi-card p-0 overflow-hidden">
        <table id="data-table">
            <thead class="bg-slate-900">
                <tr>
                    <th style="text-align:center">Year</th>
                    <th style="text-align:left">éšç´š</th>
                    <th>æ”¶å…¥</th>
                    <th>æ”¯å‡º</th>
                    <th>æŠ•è³‡</th>
                    <th>æˆ¿è²¸</th>
                    <th>æ·¨å€¼</th>
                </tr>
            </thead>
            <tbody id="table-body"></tbody>
        </table>
    </div>
</main>

<script>
const APP = {
    currentTab: 'A',
    store: { A: {}, B: {} },
    charts: {},
    rankData: {
        'äºŒå…µ': {b:10550, p:0}, 'ä¸€å…µ': {b:11130, p:0}, 'ä¸Šå…µ': {b:12280, p:0},
        'ä¸‹å£«': {b:14645, p:5500}, 'ä¸­å£«': {b:16585, p:6200}, 'ä¸Šå£«': {b:18525, p:7000},
        'ä¸‰ç­‰å£«å®˜é•·': {b:22750, p:8200}, 'äºŒç­‰å£«å®˜é•·': {b:25050, p:9500}, 'ä¸€ç­‰å£«å®˜é•·': {b:28880, p:10800},
        'å°‘å°‰': {b:22750, p:8500}, 'ä¸­å°‰': {b:25050, p:9800}, 'ä¸Šå°‰': {b:28880, p:11500},
        'å°‘æ ¡': {b:32710, p:23000}, 'ä¸­æ ¡': {b:37310, p:26000}, 'ä¸Šæ ¡': {b:41900, p:32000}
    },
    ranks: ['äºŒå…µ','ä¸€å…µ','ä¸Šå…µ','ä¸‹å£«','ä¸­å£«','ä¸Šå£«','ä¸‰ç­‰å£«å®˜é•·','äºŒç­‰å£«å®˜é•·','ä¸€ç­‰å£«å®˜é•·','å°‘å°‰','ä¸­å°‰','ä¸Šå°‰','å°‘æ ¡','ä¸­æ ¡','ä¸Šæ ¡'],

    init: () => {
        const opts = APP.ranks.map(r => `<option value="${r}">${r}</option>`).join('');
        document.getElementById('currentRank').innerHTML = opts;
        document.getElementById('targetRank').innerHTML = opts;

        // åˆå§‹åŒ–é è¨­å€¼
        const def = { cRank:'å°‘å°‰', tRank:'ä¸­æ ¡', years:20, realPay:0, livingPct:50, fixed:5000, rate:30, roi:6, inf:2, buyHouse:false, buyY:10, housePrice:1200, down:20, loanY:30 };
        APP.store.A = JSON.parse(JSON.stringify(def));
        APP.store.B = JSON.parse(JSON.stringify(def));
        APP.store.B.livingPct = 30; // é è¨­æ–¹æ¡ˆ B æ¯”è¼ƒçœ

        APP.loadToUI('A');
        APP.update();
    },

    switchTab: (tab) => {
        APP.saveFromUI(APP.currentTab);
        APP.currentTab = tab;
        APP.loadToUI(tab);
        APP.update();
    },

    updateInput: (id) => {
        document.getElementById(id + 'Label').innerText = document.getElementById(id).value + '%';
        APP.update();
    },

    saveFromUI: (tab) => {
        const d = APP.store[tab];
        d.cRank = document.getElementById('currentRank').value;
        d.tRank = document.getElementById('targetRank').value;
        d.years = parseInt(document.getElementById('years').value) || 20;
        d.realPay = parseInt(document.getElementById('realPay').value) || 0;
        d.livingPct = parseInt(document.getElementById('livingPct').value);
        d.fixed = parseInt(document.getElementById('fixedCost').value);
        d.roi = parseInt(document.getElementById('roi').value);
        d.buyHouse = document.getElementById('buyHouse').checked;
    },

    loadToUI: (tab) => {
        const d = APP.store[tab];
        document.getElementById('currentRank').value = d.cRank;
        document.getElementById('targetRank').value = d.tRank;
        document.getElementById('years').value = d.years;
        document.getElementById('realPay').value = d.realPay;
        document.getElementById('livingPct').value = d.livingPct;
        document.getElementById('livingPctLabel').innerText = d.livingPct + '%';
        document.getElementById('roi').value = d.roi;
        document.getElementById('roiLabel').innerText = d.roi + '%';
        document.getElementById('buyHouse').checked = d.buyHouse;
        document.getElementById('tab-A').classList.toggle('active', tab==='A');
        document.getElementById('tab-B').classList.toggle('active', tab==='B');
        document.getElementById('housing-area').classList.toggle('hidden', !d.buyHouse);
    },

    calculate: (d) => {
        let inv = 0, cash = 0, currentRankIdx = APP.ranks.indexOf(d.cRank);
        let results = { years: [], net: [], logs: [], hasError: false };

        for(let y=1; y <= d.years; y++) {
            if (y > 1 && y % 4 === 0 && currentRankIdx < APP.ranks.indexOf(d.tRank)) currentRankIdx++;
            
            let rank = APP.ranks[currentRankIdx];
            let pay = d.realPay > 0 ? d.realPay : (APP.rankData[rank].b + APP.rankData[rank].p + 15000);
            let inc = pay * 13.5;
            let exp = (pay * (d.livingPct/100) + d.fixed) * 12;
            let invest = pay * 0.3 * 12; // å›ºå®šææ’¥ 30% æŠ•è³‡
            
            inv = inv * (1 + d.roi/100) + invest;
            cash += (inc - exp - invest);
            let net = inv + cash;

            if (inc < exp) results.hasError = true;

            results.years.push(y);
            results.net.push(net);
            results.logs.push({ y, rank, inc, exp, invest, net });
        }
        return results;
    },

    update: () => {
        APP.saveFromUI(APP.currentTab);
        const rA = APP.calculate(APP.store.A);
        const rB = APP.calculate(APP.store.B);
        
        document.getElementById('kpi-A').innerText = Math.round(rA.net.slice(-1)).toLocaleString();
        document.getElementById('kpi-B').innerText = Math.round(rB.net.slice(-1)).toLocaleString();
        document.getElementById('kpi-diff').innerText = Math.round(rB.net.slice(-1) - rA.net.slice(-1)).toLocaleString();

        const curr = APP.currentTab === 'A' ? rA : rB;
        const msg = document.getElementById('budget-msg');
        msg.innerText = curr.hasError ? "ğŸš¨ è­¦ç¤ºï¼šå¹´åº¦æ”¯å‡ºè¶…éæ”¶å…¥ï¼" : "âœ… è²¡å‹™å¹³è¡¡é©—è­‰é€šé";
        msg.className = "alert-box " + (curr.hasError ? "bg-red-900 text-red-200" : "bg-emerald-900/30 text-emerald-400");

        APP.renderCharts(rA, rB);
        
        let html = '';
        curr.logs.forEach(l => {
            html += `<tr><td>${l.y}</td><td style="text-align:left">${l.rank}</td><td>${Math.round(l.inc).toLocaleString()}</td><td>${Math.round(l.exp).toLocaleString()}</td><td>${Math.round(l.invest).toLocaleString()}</td><td>0</td><td>${Math.round(l.net).toLocaleString()}</td></tr>`;
        });
        document.getElementById('table-body').innerHTML = html;
    },

    renderCharts: (rA, rB) => {
        const labels = rA.years.map(y => 'Y' + y);
        if (APP.charts.asset) APP.charts.asset.destroy();
        APP.charts.asset = new Chart(document.getElementById('chart-asset'), {
            type: 'line',
            data: { labels, datasets: [
                { label: 'æ–¹æ¡ˆ A', data: rA.net, borderColor: '#38bdf8', tension: 0.3 },
                { label: 'æ–¹æ¡ˆ B', data: rB.net, borderColor: '#10b981', tension: 0.3 }
            ]},
            options: { responsive: true, maintainAspectRatio: false }
        });
    }
};

window.onload = APP.init;
</script>
</body>
</html>
