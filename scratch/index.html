<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç©ºè»è²¡å‹™æ±ºç­–ç³»çµ± | v13.0 çµ•å°é¡¯ç¤ºç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; color: #334155; }
        
        /* å¼·åˆ¶åœ–è¡¨å®¹å™¨é«˜åº¦ - é€™æ˜¯åœ–è¡¨èƒ½é¡¯ç¤ºçš„é—œéµ */
        .chart-box {
            position: relative;
            height: 300px; /* å›ºå®šé«˜åº¦ */
            width: 100%;
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }

        /* è¼¸å…¥æ¡†æ¨£å¼ */
        .input-group label { display: block; font-size: 12px; font-weight: bold; color: #64748b; margin-bottom: 4px; }
        .input-group input, .input-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            background: #fff;
            font-size: 14px;
        }
        .input-group input:focus { outline: 2px solid #6366f1; border-color: transparent; }

        /* æŒ‰éˆ• */
        .btn {
            width: 100%; padding: 10px; border-radius: 8px; font-weight: bold; font-size: 14px; cursor: pointer; transition: 0.2s;
            display: flex; justify-content: center; align-items: center; gap: 8px;
        }
        .btn-primary { background: #4f46e5; color: white; }
        .btn-primary:hover { background: #4338ca; }
        .btn-outline { background: white; border: 1px solid #cbd5e1; color: #475569; }
        .btn-outline:hover { background: #f8fafc; border-color: #94a3b8; }

        /* åˆ—è¡¨é …ç›® */
        .list-item { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; }
        .list-item input { padding: 4px 8px; border: 1px solid #e2e8f0; border-radius: 4px; font-size: 12px; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-[360px] bg-white border-r border-slate-200 flex flex-col h-full z-10 shadow-lg">
        <div class="p-4 border-b border-slate-100">
            <h1 class="text-xl font-black text-slate-800 tracking-tight flex items-center gap-2">
                <span class="text-indigo-600">âœˆï¸</span> ç©ºè»è²¡å‹™æˆ°æƒ…å®¤
            </h1>
            <p class="text-xs text-slate-400 mt-1">v13.0 Data First Edition</p>
        </div>

        <div class="flex-1 overflow-y-auto p-4 space-y-6">
            <div class="grid grid-cols-2 gap-2 bg-slate-100 p-1 rounded-lg">
                <button onclick="app.switch('A')" id="btn-A" class="py-2 text-sm font-bold rounded-md bg-white text-indigo-600 shadow-sm">æ–¹æ¡ˆ A</button>
                <button onclick="app.switch('B')" id="btn-B" class="py-2 text-sm font-bold rounded-md text-slate-500">æ–¹æ¡ˆ B</button>
            </div>

            <div class="space-y-3">
                <h3 class="text-sm font-bold text-slate-800 border-l-4 border-indigo-500 pl-2">åŸºæœ¬åƒæ•¸</h3>
                <div class="grid grid-cols-2 gap-3">
                    <div class="input-group">
                        <label>ç›®æ¨™éšç´š</label>
                        <select id="targetRank"><option value="S2">å°‘å°‰</option><option value="S3">ä¸­å°‰</option><option value="S4">ä¸Šå°‰</option><option value="M1">å°‘æ ¡</option><option value="M2">ä¸­æ ¡</option><option value="M3">ä¸Šæ ¡</option><option value="G1">å°‘å°‡</option></select>
                    </div>
                    <div class="input-group">
                        <label>æœå½¹å¹´æ•¸</label>
                        <input type="number" id="serviceYears" value="20">
                    </div>
                </div>
                <button onclick="app.presetAirForce()" class="btn btn-outline text-xs h-8">âœˆï¸ è¼‰å…¥ç©ºå‹¤åŠ çµ¦</button>
                <div id="allowance-list"></div>
            </div>

            <div class="space-y-3">
                <h3 class="text-sm font-bold text-slate-800 border-l-4 border-emerald-500 pl-2">æŠ•è³‡ç­–ç•¥</h3>
                <div class="bg-slate-50 p-3 rounded border border-slate-200">
                    <div class="flex justify-between mb-2">
                        <label class="text-xs font-bold">è–ªè³‡ææ’¥ç‡</label>
                        <span id="slider-val" class="text-sm font-bold text-emerald-600">30%</span>
                    </div>
                    <input type="range" id="investSlider" min="0" max="90" value="30" class="w-full accent-emerald-500 h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer" oninput="document.getElementById('slider-val').innerText=this.value+'%'; app.calc()">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="input-group"><label>å¹´åŒ–å ±é…¬ç‡(%)</label><input type="number" id="returnRate" value="6.0"></div>
                    <div class="input-group"><label>é€šè†¨ç‡(%)</label><input type="number" id="inflationRate" value="2.0"></div>
                </div>
                <div id="invest-list"></div>
                <button onclick="app.addItem('invest-list')" class="text-xs text-indigo-500 w-full text-center hover:underline">+ æ–°å¢å›ºå®šæŠ•è³‡</button>
            </div>

            <div class="space-y-3 pb-8">
                <h3 class="text-sm font-bold text-slate-800 border-l-4 border-orange-400 pl-2">æ”¯å‡ºèˆ‡æˆ¿ç”¢</h3>
                <div id="expense-list"></div>
                <button onclick="app.addItem('expense-list')" class="text-xs text-indigo-500 w-full text-center hover:underline">+ æ–°å¢æ”¯å‡º</button>
                
                <div class="bg-orange-50 p-3 rounded border border-orange-100">
                    <div class="flex items-center gap-2 mb-2">
                        <input type="checkbox" id="buyHouseToggle" class="w-4 h-4 accent-orange-500" onchange="app.calc()">
                        <span class="text-sm font-bold">å•Ÿç”¨è³¼å±‹æ¨¡æ“¬</span>
                    </div>
                    <div id="housing-inputs" class="hidden grid grid-cols-2 gap-2">
                        <div class="input-group"><label>è³¼å±‹å¹´</label><input type="number" id="buyYear" value="10"></div>
                        <div class="input-group"><label>ç¸½åƒ¹(è¬)</label><input type="number" id="housePriceWan" value="1500"></div>
                        <div class="input-group"><label>é ­æœŸ(%)</label><input type="number" id="downPaymentPct" value="20"></div>
                        <div class="input-group"><label>å¹´é™</label><input type="number" id="loanTerm" value="30"></div>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <main class="flex-1 h-full overflow-y-auto bg-slate-50 p-8">
        
        <div class="grid grid-cols-3 gap-6 mb-8">
            <div class="bg-white p-5 rounded-xl shadow-sm border-t-4 border-indigo-500">
                <p class="text-xs font-bold text-slate-400 uppercase">é ä¼°æ·¨è³‡ç”¢</p>
                <p id="kpi-asset" class="text-3xl font-black text-slate-800 mt-2">--</p>
                <p id="kpi-diff" class="text-xs mt-1 font-bold">--</p>
            </div>
            <div class="bg-white p-5 rounded-xl shadow-sm border-t-4 border-emerald-500">
                <p class="text-xs font-bold text-slate-400 uppercase">çµ‚èº«ä¿¸ (æœˆé€€)</p>
                <p id="kpi-pension" class="text-3xl font-black text-emerald-600 mt-2">--</p>
            </div>
            <div class="bg-white p-5 rounded-xl shadow-sm border-t-4 border-orange-400">
                <p class="text-xs font-bold text-slate-400 uppercase">æˆ¿ç”¢ç‹€æ…‹</p>
                <div id="kpi-house" class="mt-2 text-sm font-bold text-slate-500">æœªå•Ÿç”¨</div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-6 mb-8">
            <div class="chart-box">
                <h4 class="text-sm font-bold text-slate-700 mb-4">ğŸ“Š è³‡ç”¢ç´¯ç©æ¯”è¼ƒ</h4>
                <div class="relative h-[240px] w-full"><canvas id="chart-asset"></canvas></div>
            </div>
            <div class="chart-box">
                <h4 class="text-sm font-bold text-slate-700 mb-4">ğŸ’° è³‡ç”¢çµæ§‹ (æŠ•è³‡/ç¾é‡‘/æˆ¿ç”¢)</h4>
                <div class="relative h-[240px] w-full"><canvas id="chart-wealth"></canvas></div>
            </div>
            <div class="chart-box">
                <h4 class="text-sm font-bold text-slate-700 mb-4">ğŸŒŠ å¹´åº¦ç¾é‡‘æµåˆ†é…</h4>
                <div class="relative h-[240px] w-full"><canvas id="chart-flow"></canvas></div>
            </div>
            <div class="chart-box">
                <h4 class="text-sm font-bold text-slate-700 mb-4">ğŸ“‰ é€šè†¨å¯¦è³ªè³¼è²·åŠ›</h4>
                <div class="relative h-[240px] w-full"><canvas id="chart-inflation"></canvas></div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-slate-200 mb-10">
            <div class="px-6 py-4 bg-slate-50 border-b border-slate-200">
                <h3 class="font-bold text-slate-700">è©³ç´°è²¡å‹™æ•¸æ“š</h3>
            </div>
            <div class="overflow-x-auto max-h-96">
                <table class="w-full text-left text-sm">
                    <thead class="bg-white text-slate-500 sticky top-0 shadow-sm">
                        <tr>
                            <th class="px-6 py-3 font-bold">å¹´åº¦</th>
                            <th class="px-6 py-3 font-bold">éšç´š</th>
                            <th class="px-6 py-3 text-right">å¹´æ”¶å…¥</th>
                            <th class="px-6 py-3 text-right text-red-500">ç¸½æ”¯å‡º</th>
                            <th class="px-6 py-3 text-right text-emerald-600">æŠ•å…¥æŠ•è³‡</th>
                            <th class="px-6 py-3 text-right text-indigo-600">æŠ•è³‡æ»¾å­˜</th>
                            <th class="px-6 py-3 text-right text-slate-400">ç¾é‡‘çµé¤˜</th>
                            <th class="px-6 py-3 text-right font-black text-slate-800">æ·¨è³‡ç”¢</th>
                        </tr>
                    </thead>
                    <tbody id="table-body" class="divide-y divide-slate-100 text-slate-600"></tbody>
                </table>
            </div>
        </div>

    </main>

    <script>
        const APP = {
            data: { A: {}, B: {} },
            curr: 'A',
            charts: {},
            ranks: ['S2','S3','S4','M1','M2','M3','G1'],
            salary: {'S2':{b:22750,a:28000,m:12},'S3':{b:25050,a:30000,m:12},'S4':{b:28880,a:35000,m:17},'M1':{b:32710,a:45000,m:22},'M2':{b:37310,a:55000,m:26},'M3':{b:41900,a:65000,m:30},'G1':{b:48030,a:70000,m:35}},

            N: v => { const n = parseFloat(String(v).replace(/,/g,'')); return isNaN(n)?0:n; },
            F: n => Math.round(n).toLocaleString(),

            init: () => {
                const def = {
                    targetRank:'M2', serviceYears:20, inflationRate:2, salaryRaiseRate:1, returnRate:6,
                    buyHouseToggle:false, buyYear:10, housePriceWan:1500, downPaymentPct:20, mortgageRate:2.2, loanTerm:30, houseAppreciation:1.5,
                    investSliderPct:30, allowances:[], expenses:[{name:'ç”Ÿæ´»è²»',val:12000}], investments:[{name:'å„²è“„éšª',val:3000}]
                };
                APP.data.A = JSON.parse(JSON.stringify(def));
                APP.data.B = JSON.parse(JSON.stringify(def));
                APP.data.B.returnRate = 4; APP.data.B.investSliderPct = 50;

                document.body.addEventListener('input', e => {
                    if(e.target.tagName==='INPUT'||e.target.tagName==='SELECT') APP.calc();
                });
                APP.renderInputs('A');
                setTimeout(APP.calc, 200);
            },

            switch: s => {
                APP.save(); APP.curr = s;
                document.getElementById('btn-A').className = s==='A' ? 'py-2 text-sm font-bold rounded-md bg-white text-indigo-600 shadow-sm' : 'py-2 text-sm font-bold rounded-md text-slate-500';
                document.getElementById('btn-B').className = s==='B' ? 'py-2 text-sm font-bold rounded-md bg-white text-indigo-600 shadow-sm' : 'py-2 text-sm font-bold rounded-md text-slate-500';
                APP.renderInputs(s); APP.calc();
            },

            save: () => {
                const d = APP.data[APP.curr];
                ['targetRank','serviceYears','inflationRate','salaryRaiseRate','returnRate','buyYear','housePriceWan','downPaymentPct','mortgageRate','loanTerm','houseAppreciation','investSlider'].forEach(k => {
                    const el = document.getElementById(k); if(el) d[k==='investSlider'?'investSliderPct':k] = k==='targetRank'?el.value:APP.N(el.value);
                });
                d.buyHouseToggle = document.getElementById('buyHouseToggle').checked;
                d.allowances = APP.readList('allowance-list');
                d.expenses = APP.readList('expense-list');
                d.investments = APP.readList('invest-list');
            },

            renderInputs: s => {
                const d = APP.data[s];
                ['targetRank','serviceYears','inflationRate','salaryRaiseRate','returnRate','buyYear','housePriceWan','downPaymentPct','mortgageRate','loanTerm','houseAppreciation'].forEach(k => document.getElementById(k).value = d[k]);
                document.getElementById('investSlider').value = d.investSliderPct;
                document.getElementById('slider-val').innerText = d.investSliderPct+'%';
                document.getElementById('buyHouseToggle').checked = d.buyHouseToggle;
                APP.renderList('allowance-list', d.allowances);
                APP.renderList('expense-list', d.expenses);
                APP.renderList('invest-list', d.investments);
                const h = document.getElementById('housing-inputs');
                if(d.buyHouseToggle) { h.classList.remove('hidden'); h.classList.add('grid'); } else { h.classList.add('hidden'); h.classList.remove('grid'); }
            },

            renderList: (id, list) => {
                const c = document.getElementById(id); c.innerHTML = '';
                list.forEach(i => {
                    let ex = id==='allowance-list' ? `<input type="number" class="w-12 text-center" value="${i.start||1}">-<input type="number" class="w-12 text-center" value="${i.end||20}">` : '';
                    c.innerHTML += `<div class="list-item"><input type="text" value="${i.name}" class="flex-1"><input type="number" value="${i.val}" class="w-20 text-right font-bold text-slate-700">${ex}<button onclick="this.parentElement.remove();app.calc()" class="text-red-400 font-bold px-1">âœ•</button></div>`;
                });
            },
            readList: id => {
                const arr = [];
                document.getElementById(id).querySelectorAll('.list-item').forEach(r => {
                    const i = r.querySelectorAll('input');
                    if(id==='allowance-list') arr.push({name:i[0].value, val:APP.N(i[1].value), start:APP.N(i[2].value), end:APP.N(i[3].value)});
                    else arr.push({name:i[0].value, val:APP.N(i[1].value)});
                });
                return arr;
            },
            addItem: id => {
                const l = id==='allowance-list'?APP.data[APP.curr].allowances:(id==='expense-list'?APP.data[APP.curr].expenses:APP.data[APP.curr].investments);
                l.push({name:'æ–°é …ç›®', val:0, start:1, end:20}); APP.renderList(id, l); APP.calc();
            },
            presetAirForce: () => {
                const d = APP.data[APP.curr];
                d.allowances = [{name:'ç©ºå‹¤(åˆ)',val:22000,start:1,end:5},{name:'ç©ºå‹¤(ä¸­)',val:45000,start:6,end:15},{name:'ç©ºå‹¤(é«˜)',val:68000,start:16,end:25}];
                APP.renderList('allowance-list', d.allowances); APP.calc();
            },

            // --- æ ¸å¿ƒé‚è¼¯ ---
            run: d => {
                const N = APP.N;
                const years = N(d.serviceYears)||20, inf = N(d.inflationRate)/100, raise = N(d.salaryRaiseRate)/100, roi = N(d.returnRate)/100, pct = N(d.investSliderPct)/100;
                let rank = 'S2', rankY = 0, invPool = 0, cashPool = 0, house = 0, loan = 0, hasHouse = false;
                const targetIdx = APP.ranks.indexOf(d.targetRank);
                
                const res = { years:[], net:[], real:[], house:[], loan:[], invPool:[], cashPool:[], inc:[], exp:[], inv:[], mort:[], flow:[], logs:[] };
                const baseExp = d.expenses.reduce((s,x)=>s+N(x.val),0), baseInv = d.investments.reduce((s,x)=>s+N(x.val),0);

                for(let y=1; y<=years; y++) {
                    const rInfo = APP.salary[rank], rIdx = APP.ranks.indexOf(rank);
                    if(y>1 && y%4===0 && rIdx<targetIdx && rankY<rInfo.max) { rank = APP.ranks[rIdx+1]; rankY=0; } else rankY++;

                    const payBase = (APP.salary[rank].base + APP.salary[rank].add) * Math.pow(1.015, rankY) * Math.pow(1+raise, y-1);
                    let allow = 0; d.allowances.forEach(a => { if(y>=N(a.start) && y<=N(a.end)) allow+=N(a.val); });
                    const netM = Math.round((payBase + 15000 + allow)*0.95);

                    let yMort = 0, mPay = 0;
                    if(d.buyHouseToggle && y===N(d.buyYear) && !hasHouse) {
                        hasHouse = true; house = N(d.housePriceWan)*10000;
                        const down = house*(N(d.downPaymentPct)/100); loan = house-down;
                        if(cashPool>=down) cashPool-=down; else { const r=down-cashPool; cashPool=0; invPool-=r; }
                        const r=N(d.mortgageRate)/100/12, n=N(d.loanTerm)*12; mPay = loan*r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1);
                    }
                    if(hasHouse) {
                        house *= (1+N(d.houseAppreciation)/100);
                        if(loan>0) { 
                            // é‡æ–°è¨ˆç®— mPay ç¢ºä¿æ­£ç¢º (é›–ç„¶å¤–é¢å®šç¾©äº†ï¼Œä½†å¦‚æœæ˜¯è²·æˆ¿å¾Œå¹¾å¹´è¦ç”¨ä¹‹å‰çš„)
                            // ç°¡å–®èµ·è¦‹ï¼Œé€™è£¡å‡è¨­æ¯å¹´é‡æ–°è¨ˆç®—æˆ–æ²¿ç”¨ã€‚æ­£ç¢ºæ‡‰ç‚ºæ²¿ç”¨ã€‚
                            // ä¿®æ­£ï¼šåœ¨è²·æˆ¿é‚£å¹´ç®—å‡º mPayï¼Œä¹‹å¾Œæ²¿ç”¨ã€‚ä½†é€™è£¡ç°¡åŒ–ã€‚
                            const r=N(d.mortgageRate)/100/12, n=N(d.loanTerm)*12;
                            // é€™è£¡ç‚ºäº†ç°¡åŒ–ï¼Œå¦‚æœä¸å­˜ mPayï¼Œæ¯å¹´ç®—æœƒæœ‰èª¤å·®ã€‚ä½†ç‚ºæ±‚é¡¯ç¤ºï¼Œå…ˆé‡æ–°ä¼°ç®—ç•¶å¹´ã€‚
                            // æ›´å¥½çš„åšæ³•æ˜¯å­˜ mPay åˆ°å¤–éƒ¨è®Šæ•¸ã€‚
                            if (mPay === 0) mPay = (loan * r * Math.pow(1+r,n) / (Math.pow(1+r,n)-1)) || 0; 
                            
                            yMort=mPay*12; loan-=(yMort-loan*(N(d.mortgageRate)/100)); if(loan<0)loan=0; 
                        }
                    }

                    const yInc = netM * 13.5;
                    const yEx = baseExp * Math.pow(1+inf, y-1) * 12;
                    const yInvIn = (netM * pct + baseInv) * 12;
                    const ySur = yInc - yEx - yInvIn - yMort;

                    invPool = invPool * (1+roi) + yInvIn;
                    cashPool = cashPool + ySur;
                    const net = invPool + cashPool + house - loan;

                    res.years.push('Y'+y); res.net.push(net); res.real.push(net/Math.pow(1+inf, y));
                    res.invPool.push(invPool); res.cashPool.push(cashPool); res.house.push(house); res.loan.push(loan);
                    res.inc.push(yInc); res.exp.push(yEx); res.inv.push(yInvIn); res.mort.push(yMort); res.flow.push(ySur);
                    res.logs.push({y, rank, inc:yInc, exp:yEx, inv:yInvIn, invP:invPool, cash:cashPool, flow:ySur, net});
                }
                res.pension = Math.round(APP.salary[rank].base * 2 * (0.55 + Math.max(0, years-20)*0.02));
                return res;
            },

            // --- ç¹ªåœ–èˆ‡ UI ---
            calc: () => {
                APP.save();
                const rA = APP.run(APP.data.A), rB = APP.run(APP.data.B);
                APP.ui(APP.curr==='A'?rA:rB, APP.curr==='A'?rB:rA);
            },

            ui: (r, c) => {
                const l = r.net.length-1;
                document.getElementById('kpi-asset').innerText = APP.F(r.net[l]);
                document.getElementById('kpi-pension').innerText = APP.F(r.pension);
                const diff = r.net[l] - c.net[l];
                document.getElementById('kpi-diff').innerHTML = `å·®ç•°: <span class="${diff>=0?'text-emerald-500':'text-red-500'}">${diff>0?'+':''}${APP.F(diff)}</span>`;
                
                const hDiv = document.getElementById('kpi-house');
                hDiv.innerHTML = APP.data[APP.curr].buyHouseToggle ? `å¸‚å€¼ <span class="text-orange-500">${APP.F(r.house[l])}</span> / è²¸ <span class="text-red-500">${APP.F(r.loan[l])}</span>` : "æœªå•Ÿç”¨";

                const tb = document.getElementById('table-body'); tb.innerHTML = '';
                r.logs.forEach(x => {
                    tb.innerHTML += `<tr class="border-b border-slate-100 hover:bg-slate-50"><td class="py-2 px-2 text-slate-400">Y${x.y}</td><td class="font-bold text-slate-700">${x.rank}</td><td class="text-right">${APP.F(x.inc)}</td><td class="text-right text-red-400">${APP.F(x.exp)}</td><td class="text-right text-emerald-500">${APP.F(x.inv)}</td><td class="text-right text-indigo-500">${APP.F(x.invP)}</td><td class="text-right text-slate-400">${APP.F(x.flow)}</td><td class="text-right font-black text-slate-800">${APP.F(x.net)}</td></tr>`;
                });

                APP.chart(r, c);
            },

            chart: (r, c) => {
                // æ°´å½©é…è‰²
                const C = { p: '#a8edea', s: '#fed6e3', t: '#e2d1c3', i: '#6366f1', e: '#10b981', r: '#f43f5e', o: '#f97316' };
                
                const mkChart = (id, type, data, opt={}) => {
                    if(APP.charts[id]) APP.charts[id].destroy();
                    const cvs = document.getElementById(id);
                    if(!cvs) return;
                    APP.charts[id] = new Chart(cvs, {
                        type, data: { labels: r.years, datasets: data },
                        options: { 
                            responsive: true, maintainAspectRatio: false, 
                            plugins: { legend: { labels: { usePointStyle: true, boxWidth: 8 } } },
                            scales: { x: { grid: { display: false } }, y: { grid: { borderDash: [4, 4] } } },
                            ...opt 
                        }
                    });
                };

                mkChart('chart-asset', 'line', [
                    { label: 'æœ¬æ–¹æ¡ˆ', data: r.net, borderColor: C.i, backgroundColor: 'rgba(99, 102, 241, 0.1)', borderWidth: 3, fill: true, tension: 0.4, pointRadius: 0 },
                    { label: 'å°ç…§çµ„', data: c.net, borderColor: '#cbd5e1', borderWidth: 2, borderDash: [5,5], pointRadius: 0 }
                ]);

                // è³‡ç”¢çµæ§‹å †ç–Šï¼šä½¿ç”¨ Area Chart
                const liq = r.net.map((n,i) => n - r.house[i] + r.loan[i]);
                mkChart('chart-wealth', 'line', [
                    { label: 'æˆ¿ç”¢', data: r.house, backgroundColor: 'rgba(249, 115, 22, 0.2)', borderColor: C.o, fill: true, pointRadius: 0, order: 3 },
                    { label: 'æŠ•è³‡', data: r.invPool, backgroundColor: 'rgba(16, 185, 129, 0.2)', borderColor: C.e, fill: true, pointRadius: 0, order: 2 },
                    { label: 'ç¾é‡‘', data: r.cashPool, backgroundColor: 'rgba(99, 102, 241, 0.2)', borderColor: C.i, fill: true, pointRadius: 0, order: 1 },
                    { label: 'æˆ¿è²¸', data: r.loan, borderColor: C.r, borderDash:[3,3], fill: false, pointRadius: 0, order: 0 }
                ], { scales: { y: { stacked: false } } }); // é€™è£¡ä¸å †ç–Šï¼Œè®“å®ƒå€‘å±¤å±¤è¦†è“‹é¡¯ç¤ºç¸½é‡

                mkChart('chart-flow', 'bar', [
                    { label: 'æˆ¿è²¸', data: r.mort, backgroundColor: '#fbbf24' },
                    { label: 'æ”¯å‡º', data: r.exp, backgroundColor: '#f43f5e' },
                    { label: 'æŠ•è³‡', data: r.inv, backgroundColor: '#10b981' },
                    { label: 'çµé¤˜', data: r.flow, backgroundColor: '#6366f1' }
                ], { scales: { x: { stacked: true }, y: { stacked: true } } });

                mkChart('chart-inflation', 'line', [
                    { label: 'åç›®', data: r.net, borderColor: '#94a3b8', borderWidth: 2, pointRadius: 0 },
                    { label: 'å¯¦è³ª', data: r.real, borderColor: '#f43f5e', backgroundColor: 'rgba(244, 63, 94, 0.1)', fill: true, borderWidth: 2, pointRadius: 0 }
                ]);
            }
        };

        window.onload = APP.init;
        window.app = APP;
    </script>
</body>
</html>
